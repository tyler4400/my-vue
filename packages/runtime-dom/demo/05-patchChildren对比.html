<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>05-patchChildren 对比（官方 vs 自定义 renderCustom/hCustom）</title>
  <style>
    body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; }
    #controls { padding: 12px; border-bottom: 1px solid #e5e7eb; position: sticky; top: 0; background: #fff; }
    #controls button { margin-right: 8px; padding: 6px 10px; border: 1px solid #d1d5db; background: #f9fafb; border-radius: 6px; cursor: pointer; }
    #controls button:focus { outline: 2px solid #2563eb; outline-offset: 2px; }
    main { padding: 12px; }
    .case { border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px; margin-bottom: 14px; background: #fff; }
    .case h3 { margin: 0 0 6px; font-size: 14px; color: #111827; }
    .desc { color: #6b7280; font-size: 12px; margin-bottom: 8px; line-height: 1.4; }
    .actions { margin-bottom: 8px; }
    .actions button { margin-right: 6px; padding: 4px 8px; border: 1px solid #d1d5db; background: #f9fafb; border-radius: 6px; cursor: pointer; }
    .row { display: flex; gap: 10px; }
    .panel { flex: 1; border: 1px solid #e5e7eb; padding: 10px; min-height: 80px; background: #fafafa; position: relative; }
    .panel .label { position: absolute; top: 6px; left: 8px; font-size: 12px; font-weight: 600; color: #374151; }
    .panel .content { padding-top: 20px; }
  </style>
</head>
<body>
<div id="controls" role="region" aria-label="说明">
  <div style="font-weight:600; margin-bottom:6px;">patchChildren 各情形对比（左：官方 render/h，右：自定义 renderCustom/hCustom）</div>
  <div style="color:#6b7280; font-size:12px;">每条用例点击“渲染初始/渲染更新”观察差异；特别留意 “数组→数组（官方 diff、自定义仅 log）” 与 “文本→空（官方清空、自定义可能不变）”。</div>
</div>

<main id="root"></main>

<script type="module">
  import { render, h } from "../../../node_modules/vue/dist/vue.runtime.esm-browser.js";
  import { render as renderCustom, h as hCustom } from '../dist/runtime-dom.esm.js'

  const cases = [
    {
      id: 'text-to-text',
      title: '文本 → 文本',
      desc: '旧 children 为纯文本，新 children 为不同文本（应更新 textContent）',
      makeInit: (h) => h('div', 'old'),
      makeNext: (h) => h('div', 'new'),
    },
    {
      id: 'text-to-array',
      title: '文本 → 数组',
      desc: '旧为纯文本，新为多个子节点（应清空文本并挂载子节点）',
      makeInit: (h) => h('div', 'hello'),
      makeNext: (h) => h('div', [ h('span','A'), h('span','B') ]),
    },
    {
      id: 'text-to-null',
      title: '文本 → 空',
      desc: '旧为纯文本，新为 null（官方应清空；当前实现已经覆盖此分支，也会变）',
      makeInit: (h) => h('div', 'bye'),
      makeNext: (h) => h('div', null),
    },
    {
      id: 'array-to-text',
      title: '数组 → 文本',
      desc: '旧为子节点数组，新为文本（应卸载旧子节点并设置文本）',
      makeInit: (h) => h('div', [ h('i','1'), h('i','2') ]),
      makeNext: (h) => h('div', 'text'),
    },
    {
      id: 'array-to-array',
      title: '数组 → 数组（全量 diff）',
      desc: '旧为 [A,B,C]，新为 [B,A,D]（官方会 diff；当前实现仅 log，不变更）',
      makeInit: (h) => h('ul', [ h('li',{key:'a'},'A'), h('li',{key:'b'},'B'), h('li',{key:'c'},'C') ]),
      makeNext: (h) => h('ul', [ h('li',{key:'b'},'B'), h('li',{key:'a'},'A'), h('li',{key:'d'},'D') ]),
    },
    {
      id: 'array-to-null',
      title: '数组 → 空',
      desc: '旧为子节点数组，新为 null（应卸载全部子节点）',
      makeInit: (h) => h('div', [ h('b','X'), h('b','Y') ]),
      makeNext: (h) => h('div', null),
    },
    {
      id: 'null-to-text',
      title: '空 → 文本',
      desc: '旧为 null，新为文本（应设为文本）',
      makeInit: (h) => h('div', null),
      makeNext: (h) => h('div', 'text'),
    },
    {
      id: 'null-to-array',
      title: '空 → 数组',
      desc: '旧为 null，新为子节点数组（应挂载子节点）',
      makeInit: (h) => h('div', null),
      makeNext: (h) => h('div', [ h('em','E1'), h('em','E2') ]),
    },
  ]

  const $root = document.getElementById('root')

  function createCaseSection(c) {
    const section = document.createElement('section')
    section.className = 'case'
    section.setAttribute('data-id', c.id)

    const h3 = document.createElement('h3')
    h3.textContent = `${c.title}`

    const desc = document.createElement('div')
    desc.className = 'desc'
    desc.textContent = c.desc

    const actions = document.createElement('div')
    actions.className = 'actions'
    const btnInit = document.createElement('button')
    btnInit.type = 'button'
    btnInit.setAttribute('data-action', 'init')
    btnInit.textContent = '渲染初始'
    const btnUpdate = document.createElement('button')
    btnUpdate.type = 'button'
    btnUpdate.setAttribute('data-action', 'update')
    btnUpdate.textContent = '渲染更新'
    actions.appendChild(btnInit)
    actions.appendChild(btnUpdate)

    const row = document.createElement('div')
    row.className = 'row'

    const left = document.createElement('div')
    left.className = 'panel'
    const leftLabel = document.createElement('div')
    leftLabel.className = 'label'
    leftLabel.textContent = '官方'
    const leftContent = document.createElement('div')
    leftContent.className = 'content'
    leftContent.id = `app-${c.id}`
    left.appendChild(leftLabel)
    left.appendChild(leftContent)

    const right = document.createElement('div')
    right.className = 'panel'
    const rightLabel = document.createElement('div')
    rightLabel.className = 'label'
    rightLabel.textContent = '自定义 renderCustom/hCustom'
    const rightContent = document.createElement('div')
    rightContent.className = 'content'
    rightContent.id = `custom-${c.id}`
    right.appendChild(rightLabel)
    right.appendChild(rightContent)

    row.appendChild(left)
    row.appendChild(right)

    section.appendChild(h3)
    section.appendChild(desc)
    section.appendChild(actions)
    section.appendChild(row)

    return section
  }

  function handleRender(which, c) {
    const vnodeApp = (which === 'init' ? c.makeInit(h) : c.makeNext(h))
    const vnodeCustom = (which === 'init' ? c.makeInit(hCustom) : c.makeNext(hCustom))
    render(vnodeApp, document.getElementById(`app-${c.id}`))
    renderCustom(vnodeCustom, document.getElementById(`custom-${c.id}`))
  }

  function mountAll() {
    cases.forEach((c) => {
      const section = createCaseSection(c)
      $root.appendChild(section)

      // 绑定按钮
      section.querySelector('[data-action="init"]').addEventListener('click', () => handleRender('init', c))
      section.querySelector('[data-action="update"]').addEventListener('click', () => handleRender('update', c))
    })

    // 默认全部渲染初始态
    cases.forEach(c => handleRender('init', c))
  }

  mountAll()
</script>
</body>
</html>
